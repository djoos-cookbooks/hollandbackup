#
#
# (http://docs.hollandbackup.org/config.html)
#
# Generated by Chef for <%= node[:fqdn] %>
#

[holland:backup]
plugin = <%= @conf[:plugin] %>
backups-to-keep = <%= @conf[:backups_to_keep] %>
estimated-size-factor = <%= @conf[:estimated_size_factor] %>
auto-purge-failures = <%= @conf[:auto_purge_failures] %>
purge-policy = <%= @conf[:purge_policy] %>
<% unless @conf[:before_backup_command].nil? %>
before-backup-command = <%= @conf[:before_backup_command] %>
<% end %>
<% unless @conf[:after_backup_command].nil? %>
after-backup-command = <%= @conf[:after_backup_command] %>
<% end %>
<% unless @conf[:failed_backup_command].nil? %>
failed-backup-command = <%= @conf[:failed_backup_command] %>
<% end %>

# This section defines the configuration options specific to the backup
# plugin. In other words, the name of this section should match the name
# of the plugin defined above.
[<%= @conf[:plugin] %>]
<% if @conf[:plugin] == 'mysqldump' %>
    <% unless @conf[:mysql_binpath].nil? %>
        mysql-binpath = <%= @conf[:mysql_binpath] %>
    <% end %>
    <% unless @conf[:lock_method].nil? %>
        lock-method = <%= @conf[:lock_method] %>
    <% end %>
    <% unless @conf[:exclude_invalid_views].nil? %>
        exclude-invalid-views = <%= @conf[:exclude_invalid_views] %>
    <% end %>
    <% unless @conf[:dump_routines].nil? %>
        dump-routines = <%= @conf[:dump_routines] %>
    <% end %>
    <% unless @conf[:dump_events].nil? %>
        dump-events = <%= @conf[:dump_events] %>
    <% end %>
    <% unless @conf[:stop_slave].nil? %>
        stop-slave = <%= @conf[:stop_slave] %>
    <% end %>
    <% unless @conf[:bin_log_position].nil? %>
        bin-log-position = <%= @conf[:bin_log_position] %>
    <% end %>
    <% unless @conf[:flush_logs].nil? %>
        flush-logs = <%= @conf[:flush_logs] %>
    <% end %>
    <% unless @conf[:file_per_database].nil? %>
        file-per-database = <%= @conf[:file_per_database] %>
    <% end %>
    <% unless @conf[:additional_options].nil? %>
        additional-options = <%= @conf[:additional_options] %>
    <% end %>
    <% unless @conf[:extra_defaults].nil? %>
        extra-defaults = <%= @conf[:extra_defaults] %>
    <% end %>
    <% unless @conf[:estimate_method].nil? %>
        estimate-method = <%= @conf[:estimate_method] %>
    <% end %>
<% end %>

<% unless
    @conf[:databases].nil? &&
    @conf[:exclude_databases].nil? &&
    @conf[:tables].nil? &&
    @conf[:exclude_tables].nil?
%>
# database and table filtering
<% unless @conf[:databases].nil? %>
databases = <%= @conf[:databases] %>
<% end %>
<% unless @conf[:exclude_databases].nil? %>
exclude-databases = <%= @conf[:exclude_databases] %>
<% end %>
<% unless @conf[:tables].nil? %>
tables = <%= @conf[:tables] %>
<% end %>
<% unless @conf[:exclude_tables].nil? %>
exclude-tables = <%= @conf[:exclude_tables] %>
<% end %>
<% end %>
<% unless
    @conf[:method].nil? &&
    @conf[:inline].nil? &&
    @conf[:level].nil? &&
    @conf[:bin_path].nil?
%>
[compression]
<% unless @conf[:method].nil? %>
method = <%= @conf[:method] %>
<% end %>
<% unless @conf[:inline].nil? %>
inline = <%= @conf[:inline] %>
<% end %>
<% unless @conf[:level].nil? %>
level = <%= @conf[:level] %>
<% end %>
<% unless @conf[:bin_path].nil? %>
bin-path = <%= @conf[:bin_path] %>
<% end %>
<% end %>

<% unless
    @conf[:defaults_extra_file].nil? &&
    @conf[:user].nil? &&
    @conf[:password].nil? &&
    @conf[:socket].nil? &&
    @conf[:host].nil? &&
    @conf[:port].nil?
%>
[mysql:client]
<% unless @conf[:defaults_extra_file].nil? %>
defaults-extra-file = <%= @conf[:defaults_extra_file] %>
<% end %>
<% unless @conf[:user].nil? %>
user = <%= @conf[:user] %>
<% end %>
<% unless @conf[:password].nil? %>
password = <%= @conf[:password] %>
<% end %>
<% unless @conf[:socket].nil? %>
socket = <%= @conf[:socket] %>
<% end %>
<% unless @conf[:host].nil? %>
host = <%= @conf[:host] %>
<% end %>
<% unless @conf[:port].nil? %>
port = <%= @conf[:port] %>
<% end %>
<% end %>
